import streamlit as st
import pandas as pd

# ------------------------------------------------
# 1. ë©”ì¸ ë¶„ì„ í•¨ìˆ˜ ì •ì˜
# ------------------------------------------------
def calculate_competition_score(document_count, search_volume):
    """ì´ ë¬¸ì„œ ìˆ˜ë¥¼ ì›”ê°„ ê²€ìƒ‰ëŸ‰ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ê²½ìŸ ê°•ë„ ì ìˆ˜ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤."""
    if search_volume > 0:
        # ê²½ìŸ ê°•ë„ ì ìˆ˜ ê³„ì‚°: ë¬¸ì„œ ìˆ˜ / ê²€ìƒ‰ëŸ‰
        score = document_count / search_volume
        return round(score, 2)
    return 0.0

def get_competition_grade(score):
    """ì ìˆ˜ì— ë”°ë¼ ìµœì¢… ë“±ê¸‰ê³¼ ì„¤ëª…ì„ ë°˜í™˜í•©ë‹ˆë‹¤."""
    if score == 0.0:
        return "ë°ì´í„° ë¶€ì¡± (ê²€ìƒ‰ëŸ‰ 0)", "ê²€ìƒ‰ëŸ‰ì´ 0ì´ê±°ë‚˜ ë°ì´í„°ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."
    elif score <= 5.0:
        return "âœ… í™©ê¸ˆ í‚¤ì›Œë“œ (ë§¤ìš° ìœ ë¦¬)", "ê²½ìŸì´ ë§¤ìš° ë‚®ì•„ ìƒìœ„ ë…¸ì¶œ ê°€ëŠ¥ì„±ì´ ë†’ìŠµë‹ˆë‹¤. ì ê·¹ í™œìš©í•˜ì„¸ìš”!"
    elif score <= 10.0:
        return "âš ï¸ ì–‘í˜¸ (ë„ì „í•´ ë³¼ ë§Œí•¨)", "ê²½ìŸì´ ë³´í†µ ìˆ˜ì¤€ì…ë‹ˆë‹¤. í¬ìŠ¤íŒ… í’ˆì§ˆì„ ë†’ì—¬ì•¼ í•©ë‹ˆë‹¤."
    elif score <= 20.0:
        return "âŒ ì£¼ì˜ (ê²½ìŸ ì¹˜ì—´)", "ê²€ìƒ‰ëŸ‰ ëŒ€ë¹„ ë¬¸ì„œê°€ ë§ìŠµë‹ˆë‹¤. ë” ê¸´ ë¡±í…Œì¼ í‚¤ì›Œë“œë¥¼ ë°œêµ´í•´ì•¼ í•©ë‹ˆë‹¤."
    else:
        return "ğŸš¨ ë ˆë“œ ì˜¤ì…˜ (ìƒìœ„ ë…¸ì¶œ ì–´ë ¤ì›€)", "ê²½ìŸì´ ë§¤ìš° ë†’ìŠµë‹ˆë‹¤. ë©”ì¸ í‚¤ì›Œë“œë¡œ ì‚¬ìš©ì€ í”¼í•˜ì„¸ìš”."

# ------------------------------------------------
# 2. ì›¹í˜ì´ì§€ ë ˆì´ì•„ì›ƒ ì„¤ì • (Streamlit UI)
# ------------------------------------------------
st.set_page_config(page_title="í™©ê¸ˆ í‚¤ì›Œë“œ ë¶„ì„ê¸°", layout="centered")

st.title("ğŸ”‘ ë¸”ë¡œê·¸ í™©ê¸ˆ í‚¤ì›Œë“œ ë¶„ì„ê¸° (ê²½ìŸ ê°•ë„ ì¸¡ì •)")
st.caption("ë„¤ì´ë²„ ë¸”ë¡œê·¸ ìƒìœ„ ë…¸ì¶œì„ ìœ„í•œ ìµœì í™” íˆ´")

# ì…ë ¥ í¼
with st.form("keyword_input_form"):
    st.header("1. í‚¤ì›Œë“œ ë° ë°ì´í„° ì…ë ¥")

    # Bì—´: ë¡±í…Œì¼ í‚¤ì›Œë“œ ì…ë ¥
    keyword = st.text_input("ë¶„ì„í•  ë¡±í…Œì¼ í‚¤ì›Œë“œ", placeholder="ì˜ˆ: ë¬µì€ì§€ê³ ë“±ì–´ì¡°ë¦¼ ë ˆì‹œí”¼")
    
    # Cì—´: ì›”ê°„ ê²€ìƒ‰ëŸ‰ ì…ë ¥
    search_volume = st.number_input("ì›”ê°„ ê²€ìƒ‰ëŸ‰ (PC+ëª¨ë°”ì¼ í•©ì‚°)", min_value=0, step=100, format="%i", value=12000)
    
    # Dì—´: ì´ ë¬¸ì„œ ìˆ˜ ì…ë ¥
    document_count = st.number_input("ì´ ë¬¸ì„œ ìˆ˜ (ë¸”ë¡œê·¸ ë°œí–‰ëŸ‰)", min_value=0, step=1000, format="%i", value=50000)
    
    # ì œì¶œ ë²„íŠ¼
    submitted = st.form_submit_button("ê²½ìŸ ê°•ë„ ë¶„ì„ ì‹œì‘")

# ------------------------------------------------
# 3. ë¶„ì„ ì‹¤í–‰ ë° ê²°ê³¼ ì¶œë ¥
# ------------------------------------------------
if submitted and keyword:
    # Eì—´: ì ìˆ˜ ê³„ì‚°
    score = calculate_competition_score(document_count, search_volume)
    # Fì—´: ë“±ê¸‰ íŒë³„
    grade, description = get_competition_grade(score)

    st.divider()
    st.header("2. ë¶„ì„ ê²°ê³¼")

    # ê²°ê³¼ í…Œì´ë¸” (ê²½ìŸ ê°•ë„ ì ìˆ˜ë¥¼ ì‹œê°ì ìœ¼ë¡œ í‘œì‹œ)
    st.metric(label="âœ… ê²½ìŸ ê°•ë„ ì ìˆ˜ (ë¬¸ì„œ ìˆ˜ / ê²€ìƒ‰ëŸ‰)", value=score)
    
    # ìµœì¢… ë“±ê¸‰ í‘œì‹œ
    if score <= 5.0:
        st.success(f"**ìµœì¢… ë“±ê¸‰:** {grade}")
    elif score <= 10.0:
        st.warning(f"**ìµœì¢… ë“±ê¸‰:** {grade}")
    else:
        st.error(f"**ìµœì¢… ë“±ê¸‰:** {grade}")
        
    st.info(description)

    st.subheader("ğŸ’¡ í™œìš© ì „ëµ")
    if score <= 10.0:
        st.markdown(f"- **ì œëª© ìµœì í™”:** ì œëª© ë§¨ ì•ì— **`{keyword}`**ë¥¼ ë°°ì¹˜í•˜ê³ , í´ë¦­ ìœ ë„ ë¬¸êµ¬(ì˜ˆ: ë¹„ë²•, ì‹¤íŒ¨ì—†ëŠ”)ë¥¼ ì¶”ê°€í•˜ì„¸ìš”.")
        st.markdown("- **ë³¸ë¬¸ ìµœì í™”:** ë³¸ë¬¸ ì†Œì œëª©ì— í‚¤ì›Œë“œë¥¼ 3~5íšŒ ìì—°ìŠ¤ëŸ½ê²Œ ë°˜ë³µí•˜ê³ , ë…ìê°€ ì›í•˜ëŠ” ì •ë³´ë¥¼ ëª…í™•íˆ ì œê³µí•˜ì„¸ìš”.")
    else:
        st.markdown("- **ì „ëµ ë³€ê²½:** ì´ í‚¤ì›Œë“œëŠ” ê²½ìŸì´ ì¹˜ì—´í•©ë‹ˆë‹¤. ë” êµ¬ì²´ì ì´ê³  ê¸´ **ë¡±í…Œì¼ í‚¤ì›Œë“œ**ë¥¼ ì°¾ê±°ë‚˜ ì£¼ì œë¥¼ ì„¸ë¶„í™”í•´ì•¼ í•©ë‹ˆë‹¤.")